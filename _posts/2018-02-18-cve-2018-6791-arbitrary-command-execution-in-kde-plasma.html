---
title: CVE-2018-6791 | Arbitrary Command Execution in KDE
desc: CVE-2018-6791 | PoC | Arbitrary Command Execution in KDE Plasma
layout: post
date: 2018-02-18 08:30:00 +0000
image: /images/posts/kde.png
---

<h3 class="cyan-text">CVE-2018-6791 | PoC | Arbitrary Command Execution in KDE Plasma</h3>

<h4 class="cyan-text">Introduction</h4>

<div class="content white-text">
  <p>
    An issue was discovered in KDE Plasma Workspace before 5.12.0. When a vfat thumb drive that contains \`\` or $() in its volume label is plugged in and mounted through the device notifier, it's interpreted as a shell command, leading to a possibility of arbitrary command execution. An example of an offending volume label is "$(touch b)" -- this will create a file called b in the home folder. <br>
  </p>

  <h4 class="cyan-text">Lab Setup</h4>
    <ul>
      <li><span class="cyan-text">Target OS : </span>Linux Mint 18.3 running KDE Plasma 5.8</li>
      <li><span class="cyan-text">Attacker Machine : </span>Kali Linux 2018.1</li>
    </ul>

  <h4 class="cyan-text">Vulnerability</h4>
    <p>
      The vulnerability exists in soliduiserver/deviceserviceaction.cpp in KDE Plasma Workspace before 5.12.0. When a vfat thumb drive that contains \`\` or $() in its volume label is plugged in and mounted through the device notifier, it's interpreted as a shell command, leading to a possibility of arbitrary command execution. <br> Letâ€™s take a look at soliduiserver/deviceserviceaction.cpp
      <br><br>
      This is the original unpatched code in soliduiserver/deviceserviceaction.cpp
    </p>

    <pre><code>
    void DelayedExecutor::delayedExecute(const QString &udi) {
    Solid::Device device(udi);
    QString exec = m_service.exec();
    MacroExpander mx(device);
    mx.expandMacros(exec);
    KRun::runCommand(exec, QString(), m_service.icon(), 0);
    deleteLater(); }
    </code></pre>

    <p>Here the code originally contains<p>

    <pre><code> mx.expandMacros(exec);</code></pre>

    <p>This function allows arbitrary command execution and to patch this KDE replaced this line with</p>

    <pre><code>mx.expandMacrosShellQuote(exec);</code></pre>

    <p>
      Originally the device label is not quoted and is interpreted as a shell command, ShellQuote makes the device label quoted.
    </p>

    <h4 class="cyan-text">What is FAT</h4>
      <p>
        FAT is an acronym for File Allocation Table, Introduced in 1981. Because of its age, most operating systems, including Microsoft Windows NT, Windows 98, the Macintosh OS, and some versions of UNIX, offer support for FAT. The FAT file system limits to eight character. Filenames in a FAT file system must  begin with a letter or number, and they can't contain spaces. Filenames aren't case sensitive.
      </p>

    <h4 class="cyan-text">What is VFAT</h4>
      <p>
        VFAT is an extension of the FAT file system and was introduced with Windows 95. VFAT maintains backward compatibility with FAT. For example, VFAT file names can contain up to 255 characters, spaces, and multiple periods. Although VFAT preserves the case of filenames, it's not considered case sensitive.
      </p>

    <h4 class="cyan-text">What is FAT32</h4>
      <p>
        FAT32 is actually an extension of FAT and VFAT, first introduced with Windows 95 OEM Service Release 2. FAT32 greatly enhances the VFAT file system. The greatest advantage to FAT32 is that it dramatically increases the amount of free hard disk space.
      </p>

    <h4 class="cyan-text">Proof of Concept</h4>
</div>

<div class="video-container">
  <iframe width="853" height="480" src="https://www.youtube.com/embed/_rIaMoEkjFU" frameborder="0" allowfullscreen> </iframe>
</div>
